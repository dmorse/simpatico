<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Simpatico: 4.5 Sub-Factories</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Simpatico
   &#160;<span id="projectnumber">v1.10</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">Simpatico - Simulation Package for Polymer and Molecular Liquids</a></li><li class="navelem"><a class="el" href="extend_page.html">4 Extending Simpatico</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">4.5 Sub-Factories </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="extend_potential_page.html">4.4 Potential Energy Classes</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="extend_module_page.html">4.7 Modules</a> (Next) <br />
</p>
<p>A <a class="el" href="classUtil_1_1Factory.html" title="Factory template. ">Util::Factory</a> may contain one or more subfactories. Creating a subfactories is an alternative way of adding new classes to the set that can be recognized by a Factory, without modifying the Factory implementation. Subfactories are useful for unit testing and for the construction of <a class="el" href="extend_module_page.html">modules</a>.</p>
<p>A subfactory may be added to a parent factory by calling the <a class="el" href="classUtil_1_1Factory.html#acc4e596c0a8636a5553ada58dfe898ce" title="Add a new subfactory to the list. ">Util::Factory&lt;Base&gt;::addSubfactory()</a> method of the <a class="el" href="classUtil_1_1Factory.html" title="Factory template. ">Util::Factory</a> class template. This has a signature: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Base&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUtil_1_1Factory.html#acc4e596c0a8636a5553ada58dfe898ce">Util::Factory&lt;Base&gt;::addSubfactory</a>(Factory&lt;Base&gt;&amp; subfactory);</div>
</div><!-- fragment --><p> Any number of subfactories can be added to a parent factory class.</p>
<h1><a class="anchor" id="extend_subfactory_impl_sec"></a>
Subfactory implementation</h1>
<p>Every subfactory of a Util::Factory&lt;Base&gt; object is another Util::Factory&lt;Base&gt; object. The implementation of a subfactory is thus very similar to that of the original default factory.</p>
<p>A factory and its subfactories (if any) form a tree that is searched in a depth first manner: The factory() method of the parent calls the factory method of each subfactory in a attempt to match a class name, before attempting to match it against its own explicit list of names. A recursive, depth-first search of subfactories is implemented by the trySubfactories() method. This has a signature: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Base&gt;</div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="classUtil_1_1Factory.html#a0ed7025e8764a29d33ab446c25ae4554">Util::Factory&lt;Base&gt;::trySubfactories</a>(std::string&amp; classname);</div>
</div><!-- fragment --><p> The value of the "classname" parameter is the name of a subclass of Base. This method should be called by the factory() method of every factory class (including subfactories), near the beginning of the method. It calls the factory() method of every subfactory that has been added to that factory, passing the classname string as argument. The factory() method of each subfactory attempts to match this class name, and creates a new object of the desired subclass if it recognizes the name. If a match is found by any subfactory, trySubfactories() immediately stops the search and returns a Base* pointer to the new object. If no match is found by any subfactory, trySubfactories() returns a null pointer.</p>
<p>As an example, imagine that you have written an <a class="el" href="classMcMd_1_1NvtLangevinIntegrator.html" title="A NVT molecular dynamics integrator with a Langevin thermostat. ">NvtLangevinIntegrator</a> subclass of <a class="el" href="classMcMd_1_1MdIntegrator.html" title="Abstract base for molecular dynamics integrators. ">McMd::MdIntegrator</a>, because no Langevin integrator is (thus far) distributed with Simpatico. You would then also define a subclass of <a class="el" href="classUtil_1_1Factory.html">Factory&lt;MdIntegrator&gt;</a>, which we will called "MyMdIntegratorFactory", with a factory() method that can recognize the name "NvtLangevinIntegrator" and instantiate an object of this new class. Here is an example of the required class definition: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;src/mcMd/mdIntegrators/MdIntegratorFactory.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;src/mcMd/user/NvtLangevinIntegrator.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceMcMd.html">McMd</a> </div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">   <span class="keyword">using namespace </span>Util;</div>
<div class="line"></div>
<div class="line">   <span class="keyword">class </span>MyMdIntegratorFactory : <span class="keyword">public</span> <a class="code" href="classUtil_1_1Factory.html">Factory</a>&lt;MdIntegrator&gt;</div>
<div class="line">   {</div>
<div class="line">   <span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">      <span class="keyword">virtual</span> MdIntegrator* factory(std::string &amp;classname)</div>
<div class="line">      {</div>
<div class="line">         <span class="comment">// Initialize ptr to null</span></div>
<div class="line">         MdIntegrator *ptr = 0;</div>
<div class="line"></div>
<div class="line">         <span class="comment">// Search subfactories (if any), return if matched.</span></div>
<div class="line">         ptr = trySubfactories(classname);</div>
<div class="line">         <span class="keywordflow">if</span> (ptr) <span class="keywordflow">return</span> ptr;</div>
<div class="line"></div>
<div class="line">         <span class="comment">// Attempt to explicitly match classname </span></div>
<div class="line">         <span class="keywordflow">if</span> (classname == <span class="stringliteral">&quot;NvtLangevinIntegrator&quot;</span>) {</div>
<div class="line">            ptr = <span class="keyword">new</span> NvtLangevinIntegrator(*systemPtr_);</div>
<div class="line">         }</div>
<div class="line">         <span class="keywordflow">return</span> ptr;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">   };</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p> The factory method for this subclass returns a pointer to a new <a class="el" href="classMcMd_1_1NvtLangevinIntegrator.html" title="A NVT molecular dynamics integrator with a Langevin thermostat. ">NvtLangevinIntegrator</a>, if the subclassName string is "NvtLangevinIntegrator". It returns a null pointer otherwise.</p>
<h1><a class="anchor" id="extend_subfactory_main_sec"></a>
Changes to the main program</h1>
<p>After writing a custom factory, one must invoke the addSubfactory() method of the default factory to register the new Factory as a subfactory of the default Factory. This must be done in the main program, before the readParam() method is invoked.</p>
<p>Below, we show an example of a main program for an <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem. ">MdSimulation</a> that adds a custom factory MyMdIntegratorFactory as a subfactory to the <a class="el" href="classMcMd_1_1MdIntegratorFactory.html" title="Default Factory for subclasses of MdIntegrator. ">MdIntegratorFactory</a>. </p><div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceMcMd.html">McMd</a></div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">   <span class="keywordtype">int</span> main </div>
<div class="line">   {</div>
<div class="line">      <a class="code" href="classDdMd_1_1Simulation.html">DdMd::Simulation</a> sim;</div>
<div class="line">      DdMd::MyIntegratorFactory myFactory;</div>
<div class="line"> </div>
<div class="line">      \\ Register the custom Factory with the MdSystem</div>
<div class="line">      sim.<a class="code" href="classDdMd_1_1Simulation.html#a1466f5ccbcd070b984cf8602a5b8bb43">integratorFactory</a>().<a class="code" href="classUtil_1_1Factory.html#acc4e596c0a8636a5553ada58dfe898ce">addSubfactory</a>(myFactory);</div>
<div class="line"></div>
<div class="line">      \\ Read the parameter file from standard input.</div>
<div class="line">      sim.<a class="code" href="classDdMd_1_1Simulation.html#af7672b513e7f71ad6a19b5c0a040cbb8">readParam</a>();</div>
<div class="line">  </div>
<div class="line">      \\ Read and execute the command script.</div>
<div class="line">      sim.<a class="code" href="classDdMd_1_1Simulation.html#a58f73ad42249ca9d08aea965ec0140a3">readCommands</a>();</div>
<div class="line">  </div>
<div class="line">   }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p> The addSubfactory() method must be invoked before readParam() in order for the subfactory to be available for use during processing of the parameter file.</p>
<p>When a factory is associated with a Manager object, the parent Manager class also provides an "addSubfactory()" method that has the same effect. This method simply calls the "addSubfactory() method of the associated Factory. For example, to add an analyzer subfactory named myFactory to a ddSim simulation in which the main object is named sim, one could invoke </p><div class="fragment"><div class="line">sim.<a class="code" href="classDdMd_1_1Simulation.html#a56bbdbed65ca86f2e803de69e41fe1a6">analyzerManager</a>().<a class="code" href="classUtil_1_1Manager.html#aa4b5ed1282aad551951fa086ec125aab">addSubfactory</a>(myFactory);</div>
</div><!-- fragment --><p> Here, <a class="el" href="classDdMd_1_1Simulation.html#a56bbdbed65ca86f2e803de69e41fe1a6" title="Return the AnalyzerManager by reference. ">DdMd::Simulation::analyzerManager()</a> is an accessor that returns the <a class="el" href="classDdMd_1_1AnalyzerManager.html" title="Manager for a list of Analyzer objects. ">DdMd::AnalyzerManager</a> by reference. This command is equivalent to the longer command sim.analyzerManager().factory().addSubfactory(myFactory), in which "factory()" is a member function of the Util::Manager&lt;T&gt; template that returns the associated Util::Factory&lt;T&gt; object by reference.</p>
<h1><a class="anchor" id="extend_subfactory_accessor_ddSim_sec"></a>
Accessors for Factory and Manager objects (ddSim)</h1>
<p>The modification of the main program described above requires that the user have access to the relevant factory or Manager object, in order to be able to invoke "addSubfactory()".</p>
<p>In ddSim simulations, access to Factory and Manager classes is provided by the following member functions of <a class="el" href="classDdMd_1_1Simulation.html" title="Main object for a domain-decomposition MD simulation. ">DdMd::Simulation</a>:</p>
<ul>
<li>DdMd::Factory&lt;ConfigIo&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#a7e41cb8e89401e39a90f4942a51c88d2" title="Get the configuration file reader/writer factory by reference. ">DdMd::Simulation::configIoFactory()</a></li>
<li>DdMd::Manager&lt;Analyzer&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#a56bbdbed65ca86f2e803de69e41fe1a6" title="Return the AnalyzerManager by reference. ">DdMd::Simulation::analyzerManager()</a></li>
<li>DdMd::Factory&lt;Integrator&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#a1466f5ccbcd070b984cf8602a5b8bb43" title="Get the Integrator factory by reference. ">DdMd::Simulation::integratorFactory()</a></li>
<li>DdMd::Manager&lt;Modifier&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#a5d01f3bec58bb0d6ba09907aaa069914" title="Return the ModifierManager by reference. ">DdMd::Simulation::modifierManager()</a></li>
<li>DdMd::Factory&lt;DdMd::PairPotential&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#ab48939227b9e29f5f8cf935ec92868e2" title="Get the Factory<PairPotential> by reference. ">DdMd::Simulation::pairFactory()</a></li>
<li>DdMd::Factory&lt;DdMd::BondPotential&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#a4127ff1f0bd3458414d496e0c76df4e4" title="Get the Factory<BondPotential> by reference. ">DdMd::Simulation::bondFactory()</a></li>
<li>DdMd::Factory&lt;AnglePotential&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#ac65c089925ada362d8c28d83890e2e0a" title="Get the AngleFactory by reference. ">DdMd::Simulation::angleFactory()</a></li>
<li>DdMd::Factory&lt;DihedralPotential&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#a76b51975536f942febdbd8d04c3b92fe" title="Get the associated Dihedral Factory by reference. ">DdMd::Simulation::dihedralFactory()</a></li>
<li>DdMd::Factory&lt;ExternalPotential&gt;&amp; <a class="el" href="classDdMd_1_1Simulation.html#aa502eac2282707b7a8e6898f21cbf1ca" title="Get the associated External Factory by reference. ">DdMd::Simulation::externalFactory()</a></li>
</ul>
<p>To access some factories that are associated with Manager classes, such as the <a class="el" href="classMcMd_1_1Analyzer.html" title="Abstract base for periodic output and/or analysis actions. ">Analyzer</a> and Modifier factories, one must call the <a class="el" href="classDdMd_1_1Simulation.html" title="Main object for a domain-decomposition MD simulation. ">DdMd::Simulation</a> accessor for the Manager class (listed above), and then call the addSubfactory() method of the parent Manager.</p>
<h1><a class="anchor" id="extend_subfactory_accessor_mcmdSim_sec"></a>
Accessors for Factory and Manager objects (mcSim and mdSim)</h1>
<p>In mcSim and mdSim simulations, access to different factories and managers is provided by member functions of the <a class="el" href="classMcMd_1_1Simulation.html" title="The main object in a simulation, which coordinates others. ">McMd::Simulation</a> or <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary. ">McMd::System</a> classes, or of the <a class="el" href="classMcMd_1_1McSimulation.html" title="A Monte-Carlo simulation of one McSystem. ">McSimulation</a>, <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem. ">MdSimulation</a>, <a class="el" href="classMcMd_1_1McSystem.html" title="A System for use in a Markov chain Monte Carlo simulation. ">McSystem</a> or <a class="el" href="classMcMd_1_1MdSystem.html" title="A System for Molecular Dynamics simulation. ">MdSystem</a> subclasses. The required accessor methods are:</p>
<ul>
<li>Util::Factory&lt;McMd::Species&gt;&amp; <a class="el" href="classMcMd_1_1Simulation.html#a8086af0046abf289da3cc1a85da97020" title="Return the Species Factory by reference. ">McMd::Simulation::speciesFactory()</a></li>
<li>Util::Factory&lt;McMd::Analyzer&gt;&amp; <a class="el" href="classMcMd_1_1Simulation.html#aa22dd48dc320d8cb4de6c8cc39bb20d1" title="Return the Analyzer factory by reference. ">McMd::Simulation::analyzerFactory()</a></li>
<li>Util::Factory&lt;McMd::McMove&gt;&amp; <a class="el" href="classMcMd_1_1McSimulation.html#a1e77cead3141ff5bfaa00a5fb38b06c1" title="Get the McMove factory by reference. ">McMd::McSimulation::mcMoveFactory()</a></li>
<li>Util::Factory&lt;McMd::ConfigIo&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a422a12fcd4c7d9da8d377afc58c3dd37" title="Get the configuration file reader/writer factory by reference. ">McMd::System::configIoFactory()</a></li>
<li>Util::Factory&lt;McMd::Perturbation&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a4108e1167ab8a74c302cf533374f564a" title="Get the perturbation factory by reference. ">McMd::System::perturbationFactory()</a></li>
<li>Util::Factory&lt;McMd::MdIntegrator&gt;&amp; <a class="el" href="classMcMd_1_1MdSystem.html#a2464533e36432fb77fe080b3224cfa9c" title="Return the MdIntegrator Factory by reference. ">McMd::MdSystem::mdIntegratorFactory()</a></li>
<li>Util::Factory&lt;McMd::TrajectoryIo&gt;&amp; McMd::MdSystem::trajectoryIoFactory()</li>
<li>McMd::PairFactory&amp; <a class="el" href="classMcMd_1_1System.html#a7f28c02097251e76853562ab4a97c7de" title="Get the PairFactory by reference. ">McMd::System::pairFactory()</a></li>
<li>Util::Factory&lt;McMd::BondPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a48d6b4068d96167cd4c519e56058160d" title="Get the associated Factory<BondPotential> by reference. ">McMd::System::bondFactory()</a></li>
<li>Util::Factory&lt;McMd::AnglePotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#a3fd031b5779c3b48d73d768ed815ea53" title="Get the associated AngleFactory by reference. ">McMd::System::angleFactory()</a></li>
<li>Util::Factory&lt;McMd::DihedralPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#af983d7ff0ceca8768ea01347b7af0304" title="Get the associated Dihedral Factory by reference. ">McMd::System::dihedralFactory()</a></li>
<li>Util::Factory&lt;McMd::BondPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#aa9c0fb2c5e81be12ee756bc939d01ea5" title="Get the associated Link factory by reference. ">McMd::System::linkFactory()</a></li>
<li>Util::Factory&lt;McMd::ExternalPotential&gt;&amp; <a class="el" href="classMcMd_1_1System.html#ad3beac0f5ba061c0b05fcfa208b0cf70" title="Get the associated ExternalPotential factory by reference. ">McMd::System::externalFactory()</a></li>
</ul>
<p>Member functions of the <a class="el" href="classMcMd_1_1Simulation.html" title="The main object in a simulation, which coordinates others. ">McMd::Simulation</a> and <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary. ">McMd::System</a> base classes are also available in subclasses of these classes, and so can be used in either MC or MD simulations. See the page about <a class="el" href="extend_potential_page.html">4.4 Potential Energy Classes</a> for a more detailed discussion of the peculiarities of the potential energy base and factory classes.</p>
<p>When a factory must be accessed via a member function <a class="el" href="classMcMd_1_1System.html" title="A set of interacting Molecules enclosed by a Boundary. ">McMd::System</a> or one of its subclasesses, a reference to the required <a class="el" href="classMcMd_1_1McSystem.html" title="A System for use in a Markov chain Monte Carlo simulation. ">McSystem</a> or <a class="el" href="classMcMd_1_1MdSystem.html" title="A System for Molecular Dynamics simulation. ">MdSystem</a> object can be obtained using the system() method of the parent <a class="el" href="classMcMd_1_1McSimulation.html" title="A Monte-Carlo simulation of one McSystem. ">McSimulation</a> or <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem. ">MdSimulation</a> object. For example, to add an <a class="el" href="classMcMd_1_1MdIntegrator.html" title="Abstract base for molecular dynamics integrators. ">MdIntegrator</a> factory named myFactory to an mdSim simulation, one might invoke </p><div class="fragment"><div class="line">sim.system().mdIntegratorFactory().addSubfactory(myFactory);</div>
</div><!-- fragment --><p> Here, sim is an instance of <a class="el" href="classMcMd_1_1MdSimulation.html" title="A molecular dynamics simulation of a single MdSystem. ">MdSimulation</a>. Here, the method <a class="el" href="classMcMd_1_1MdSimulation.html#a10d21bd8717ff9722f56230435b576c9" title="Get the MdSystem being simulated by reference. ">McMd::MdSimulation::system()</a> returns a reference to the associated <a class="el" href="classMcMd_1_1MdSystem.html" title="A System for Molecular Dynamics simulation. ">McMd::MdSystem</a> object.</p>
<p><br />
 <a class="el" href="extend_potential_page.html">4.4 Potential Energy Classes</a> (Prev) &#160; &#160; &#160; &#160; <a class="el" href="extend_page.html">4 Extending Simpatico</a> (Up) &#160; &#160; &#160; &#160; <a class="el" href="extend_module_page.html">4.7 Modules</a> (Next) </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 30 2015 09:54:33 for Simpatico by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
